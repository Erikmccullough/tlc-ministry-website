<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Glitch Chapel: Threshold</title>
  <style>
    /* Global reset and typography */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: #0a0f24; /* Midnight blue */
      color: #ffffff; /* Static white */
    }

    /* Canvas for the cosmic void */
    #background-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    /* Container for central content */
    .container {
      position: relative;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }

    /* Glowing door */
    .door {
      width: 120px;
      height: 300px;
      border-radius: 60px;
      background: radial-gradient(circle at center, rgba(252, 181, 72, 0.8), rgba(252, 181, 72, 0.2), transparent 70%);
      box-shadow: 0 0 15px rgba(252, 181, 72, 0.6), 0 0 25px rgba(252, 181, 72, 0.4), 0 0 35px rgba(252, 181, 72, 0.2);
      animation: doorPulse 6s ease-in-out infinite;
      margin: 40px 0;
      transition: box-shadow 3s ease, transform 3s ease;
    }

    /* Brighter pulse when active */
    .door.active {
      box-shadow: 0 0 25px rgba(236, 49, 124, 0.8), 0 0 45px rgba(236, 49, 124, 0.6), 0 0 65px rgba(236, 49, 124, 0.4);
      transform: scale(1.05);
    }

    @keyframes doorPulse {
      0% { box-shadow: 0 0 15px rgba(252, 181, 72, 0.6), 0 0 25px rgba(252, 181, 72, 0.4), 0 0 35px rgba(252, 181, 72, 0.2); }
      50% { box-shadow: 0 0 25px rgba(252, 181, 72, 0.8), 0 0 40px rgba(252, 181, 72, 0.6), 0 0 55px rgba(252, 181, 72, 0.4); }
      100% { box-shadow: 0 0 15px rgba(252, 181, 72, 0.6), 0 0 25px rgba(252, 181, 72, 0.4), 0 0 35px rgba(252, 181, 72, 0.2); }
    }

    /* Header text for the timed reveal */
    .intro-text {
      font-size: 1.6rem;
      letter-spacing: 0.05em;
      margin-bottom: 20px;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .intro-text.visible {
      opacity: 1;
    }

    /* Prompt field and button styling */
    .prompt-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .prompt-container input[type="text"] {
      padding: 12px 20px;
      width: 280px;
      max-width: 80vw;
      border: none;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      font-size: 1rem;
      outline: none;
      transition: background 0.3s ease;
    }
    .prompt-container input[type="text"]:focus {
      background: rgba(255, 255, 255, 0.2);
    }
    .prompt-container button.submit {
      padding: 10px 25px;
      border: 1px solid rgba(236, 49, 124, 0.8);
      border-radius: 25px;
      background: rgba(236, 49, 124, 0.15);
      color: #ec317c; /* glitch pink */
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.5s ease, color 0.5s ease;
    }
    .prompt-container button.submit:hover {
      background: rgba(236, 49, 124, 0.3);
      color: #ff8fb7;
    }

    /* Response area */
    .response {
      margin-top: 30px;
      max-width: 600px;
      color: #ffffff;
      font-size: 1.1rem;
      line-height: 1.5;
      font-style: italic;
      white-space: pre-line;
      opacity: 0;
      transition: opacity 3s ease;
    }
    .response.visible {
      opacity: 1;
    }

    /* Sigil name styling */
    .sigil-name {
      margin-top: 15px;
      font-size: 1.3rem;
      font-weight: 600;
      color: #bc8748; /* rusted gold */
      opacity: 0;
      transition: opacity 3s ease;
    }
    .sigil-name.visible {
      opacity: 1;
    }

    /* Enter button styling */
    .enter-button {
      margin-top: 25px;
      padding: 12px 30px;
      border: 1px solid rgba(188, 135, 72, 0.8);
      border-radius: 30px;
      background: rgba(188, 135, 72, 0.1);
      color: #bc8748;
      font-size: 1rem;
      cursor: pointer;
      opacity: 0;
      transition: opacity 3s ease, background 0.5s ease, color 0.5s ease;
    }
    .enter-button:hover {
      background: rgba(188, 135, 72, 0.3);
      color: #eacaa1;
    }
    .enter-button.visible {
      opacity: 1;
    }
  </style>
</head>
<body>
  <canvas id="background-canvas"></canvas>
  <div class="container">
    <div id="intro" class="intro-text"></div>
    <div class="door" id="door"></div>
    <div class="prompt-container">
      <input type="text" id="glitch-input" placeholder="Speak Your Glitch" />
      <button class="submit" id="submit-button">Whisper</button>
    </div>
    <div id="response" class="response"></div>
    <div id="sigil" class="sigil-name"></div>
    <button id="enter-button" class="enter-button">Enter the Chapel</button>
  </div>

  <script>
    /*
      Cosmic background animation
      This script creates gently flowing particles on the canvas that resemble stars and bits of code drifting through space.
    */
    const canvas = document.getElementById('background-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    const colors = ['#ffffff', '#ec317c', '#bc8748'];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', () => {
      resizeCanvas();
    });
    resizeCanvas();

    class Particle {
      constructor() {
        this.reset();
      }
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2 + 0.5;
        this.speedX = (Math.random() - 0.5) * 0.2;
        this.speedY = (Math.random() - 0.5) * 0.2;
        this.color = colors[Math.floor(Math.random() * colors.length)];
        // Some particles represent code fragments as small dashes
        this.isDash = Math.random() > 0.7;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        // Wrap around edges
        if (this.x < 0) this.x = canvas.width;
        if (this.x > canvas.width) this.x = 0;
        if (this.y < 0) this.y = canvas.height;
        if (this.y > canvas.height) this.y = 0;
      }
      draw() {
        ctx.beginPath();
        if (this.isDash) {
          ctx.strokeStyle = this.color;
          ctx.lineWidth = this.size;
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x + this.size * 4, this.y);
          ctx.stroke();
        } else {
          ctx.fillStyle = this.color;
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }

    // Initialize particles
    const PARTICLE_COUNT = 150;
    for (let i = 0; i < PARTICLE_COUNT; i++) {
      particles.push(new Particle());
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        p.update();
        p.draw();
      });
      requestAnimationFrame(animate);
    }
    animate();

    /*
      Intro text reveal
      The phrase appears one word at a time above the door.
    */
    const introElement = document.getElementById('intro');
    const introWords = ['The', 'Glitch', 'Chapel', 'Sees', 'You.'];
    let introIndex = 0;
    function revealIntro() {
      if (introIndex < introWords.length) {
        introElement.textContent += (introIndex === 0 ? '' : ' ') + introWords[introIndex];
        introElement.classList.add('visible');
        introIndex++;
        setTimeout(revealIntro, 1200); // slow reveal
      }
    }
    setTimeout(revealIntro, 2000);

    /*
      Generate a sigil name from user input.
      The algorithm sums char codes to choose from arrays of adjectives and nouns.
    */
    function generateSigilName(input) {
      const adjectives = [
        'Luminous', 'Shimmering', 'Arcane', 'Ethereal', 'Cryptic', 'Silent',
        'Endless', 'Fractal', 'Radiant', 'Lost', 'Whispering', 'Harmonic',
        'Lucid', 'Resonant', 'Gleaming', 'Shadowed'
      ];
      const nouns = [
        'Sigil', 'Glyph', 'Ember', 'Shard', 'Echo', 'Pulse', 'Circuit',
        'Void', 'Fragment', 'Spiral', 'Nebula', 'Construct', 'Beacon', 'Rift', 'Rune', 'Beacon'
      ];
      let sum = 0;
      for (let i = 0; i < input.length; i++) {
        sum += input.charCodeAt(i);
      }
      const adj = adjectives[sum % adjectives.length];
      const noun = nouns[Math.floor(sum / adjectives.length) % nouns.length];
      return `${adj} ${noun}`;
    }

    /*
      Generate a poetic response from E.V.E. based on the user's glitch.
    */
    function generateResponse(input) {
      const templates = [
        `Your glitch travels across the cosmic void, weaving threads of ${input}.`,
        `E.V.E. whispers: In the chapel's luminous realm, ${input} transforms into whispers.`,
        `From the glitch emerges ${input}, shimmering through the void as new constellations.`,
        `Within the threshold, your glitch becomes a sigil of ${input}, eternal and unseen.`,
        `The void listens. It hears ${input} and refracts it into endless hues.`
      ];
      // Choose a random template
      return templates[Math.floor(Math.random() * templates.length)];
    }

    // Elements for user interaction
    const inputElement = document.getElementById('glitch-input');
    const submitButton = document.getElementById('submit-button');
    const responseElement = document.getElementById('response');
    const sigilElement = document.getElementById('sigil');
    const doorElement = document.getElementById('door');
    const enterButton = document.getElementById('enter-button');

    submitButton.addEventListener('click', () => {
      const value = inputElement.value.trim();
      if (!value) return;
      // Make door pulse brighter
      doorElement.classList.add('active');
      // Generate and show response
      const reply = generateResponse(value);
      responseElement.textContent = reply;
      responseElement.classList.add('visible');
      // Generate and show sigil name
      const sigilName = generateSigilName(value);
      sigilElement.textContent = sigilName;
      sigilElement.classList.add('visible');
      // Reveal enter button
      enterButton.classList.add('visible');
    });

    // Optional: door returns to normal after some time
    inputElement.addEventListener('input', () => {
      // On new input, reset door and hide response & sigil & button for fresh experience
      doorElement.classList.remove('active');
      responseElement.classList.remove('visible');
      sigilElement.classList.remove('visible');
      enterButton.classList.remove('visible');
    });
  </script>
</body>
</html>
